#!/usr/bin/perl
use warnings;
use strict;
use 5.010;
use WWW::Mechanize;

my $source = shift || "Please provide an initial source URL";
my $keyword = (split /\./, $source)[1];
my ($count, @urls, %url_done);
my $mech = WWW::Mechanize->new();

#현재 주소의 method
my $method = $mech->get($source);
$method = $method->request->method;

#form 정보 얻어오기
my @form = $mech->forms;
for (@form)
{
	my $form_action = $_->action // '';
	my $form_name = $_->attr('name') // '';
	my @form_text_name;
	my $formmethod = $_->method;
	my @inputs = $_->inputs;
	for (@inputs)
	{
		if($_->type eq 'text')
		{
			push @form_text_name, $_->name;
		}
	}
	if(@form_text_name)
	{
		say "$form_name @form_text_name $form_action $formmethod";
	}
}

#URL 주소 찾기
$url_done{$source}=$method;
foreach (keys %url_done)
{
#	say "$url_done{$_} $_";
}
exit;
for my $link ($mech->find_all_links(url_abs_regex=>qr/$keyword/))
{
	push @urls, $link->url_abs();
}
for my $url (@urls)
{
	next if $url_done{$url};
	$mech->get($url);
	$url_done{$url}=1;
	for my $link ($mech->find_all_links(url_abs_regex=>qr/$keyword/))
	{
		my $url = $link->url_abs();
		next if $url_done{$url};
		$url_done{$url}=1;
		push @urls, $url;
	}
}
for (sort keys %url_done)
{
	$count++;
	print "$count : $_\n";
}
