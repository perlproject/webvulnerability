#!/usr/bin/perl
use warnings;
use strict;
use 5.010;

sub sql_scan
{
    my ($crawl, %crawl_urls) = @_;
    for my $url (keys %crawl_urls)
    {
        my $uri = URI->new($url);
        my $query = $uri->query;
        next if $query;
        delete $crawl_urls{$url};
    }

    say "-------SQL SCAN-------";
    for my $url(keys %crawl_urls) #sql weak point
    {
        my $abs_url = $url;
        $abs_url =~ s/=/='TEST/g;

        eval{ $crawl->get($abs_url) };
        my $response = $crawl->response;
        my $content = $response->decoded_content;
        if($content =~ /(Microsoft SQL|MySQL|ORA)/i)
        {
            $crawl_urls{$url} = $1;
            say $url;
        }
        else
        {
            delete $crawl_urls{$url};
        }
    }
    %crawl_urls;
}
1;    
